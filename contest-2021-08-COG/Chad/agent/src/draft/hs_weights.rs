use std::time::Duration;

use super::CardPicker;
use crate::model::{Action, Card, Opponent, Player};

#[derive(Default)]
pub struct HSWeightsPicker;
impl HSWeightsPicker {
    pub const WEIGHTS: [[isize; 160]; 2] = [
        [
            -177, -133, 130, 99, 105, 190, 164, 170, -15, -132, 186, -47, 41, 108, -1, 17, -121,
            112, 1, -9, -177, 10, -21, -151, -108, 188, 171, 63, 37, 170, 21, -129, 33, -3, -97,
            -30, -138, 120, 128, 166, 200, -13, -131, -197, 128, -85, 43, 42, -82, -71, 89, 134,
            170, 89, 17, 56, -188, 103, 27, -69, -129, -9, 36, 133, -28, 169, -114, 196, 167, 26,
            -51, 4, -80, 16, 167, 11, -182, 98, -147, 41, 11, 32, -143, 180, 104, 168, 19, -31,
            -72, 64, -183, -77, 185, 95, -47, -40, 172, 28, 93, -147, 111, -17, 93, -95, -18, -3,
            -14, -99, -171, 116, 38, -184, 61, -1, -95, -82, 60, -57, 108, -194, -16, -30, 168,
            122, 42, 117, 149, 97, 21, -12, 127, 83, 161, -61, -23, 144, 62, -26, -56, -199, -36,
            -181, -77, 187, 69, 17, -150, -83, 24, -110, -158, -149, -139, -121, -96, 148, -64,
            -111, 108, -192,
        ],
        [
            175, 128, -42, 107, 137, 180, 181, -125, 110, 138, 190, -51, 46, -135, -70, 37, -121,
            118, 2, 45, 106, 1, -29, 125, 64, 179, 166, -98, 24, 167, 21, -117, -177, -17, 20, 161,
            -165, 157, 149, 166, 192, -108, -131, -197, 6, -55, 63, 42, 116, -165, 19, -129, 80,
            37, -157, 56, -114, 151, -86, -62, -116, -117, 61, 130, -146, -81, -127, -200, 167, 38,
            -46, -162, 8, -11, -97, 41, -176, 52, -94, 185, 103, 96, -152, 199, 112, -177, 21,
            -104, 97, 77, -179, -77, 176, -199, -188, 130, 172, 8, -101, 156, -24, 199, 97, -17,
            -43, -54, -152, -99, -181, -89, 151, -74, -199, -67, -157, -57, 117, 157, 180, -194,
            -28, 159, 91, 38, -156, 117, -181, 151, -6, -12, 171, 89, -97, 181, 28, -148, -43, -18,
            -69, 190, 84, 196, -76, -127, -83, -29, 118, -17, 120, 129, 166, -134, -17, -121, -94,
            179, -64, 110, 115, -184,
        ],
    ];
}

impl CardPicker for HSWeightsPicker {
    fn pick(
        &mut self,
        player: &Player,
        _opponent: &Opponent,
        _time_left: Duration,
    ) -> (Card, Action) {
        let (idx, card) = player
            .base
            .hand
            .iter()
            .enumerate()
            .max_by_key(|(_, card)| {
                Self::WEIGHTS[(player.base.player_order as usize).saturating_sub(1)][card.id - 1]
                // Self::WEIGHTS[0][card.id - 1]
            })
            .unwrap();

        (*card, Action::Pick { idx: idx as u8 })
    }
}
